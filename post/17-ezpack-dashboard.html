<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    
      <title>
        ezpack dashboard | Leodots
      </title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style type="text/css" data-styled-components="djiuUw ehFhRk bjznky ehsBOr cKUUOL bUfeR dQozFt bxrUCS hBdBXi gQextd" data-styled-components-is-local="true">/* sc-component-id: sc-bdVaJa */
.sc-bdVaJa {}

.djiuUw{display:block;text-align:center;padding:0;margin:0;padding-top:30px;list-style:none;height:55px;margin-left:calc(100vw - 100%);}@media screen and (max-width:770px){.djiuUw{display:none;}}
/* sc-component-id: sc-bwzfXH */
.sc-bwzfXH {}

.ehFhRk{text-align:center;font-size:18px;margin:0 25px;display:inline-block;}.ehFhRk:hover{border-bottom:2px solid #222;}.ehFhRk > a{-webkit-text-decoration:none;text-decoration:none;color:#222;}
/* sc-component-id: sc-htpNat */
.sc-htpNat {}

.bjznky{position:relative;}@media screen and (min-width:770px){.bjznky{display:none;}}
/* sc-component-id: sc-bxivhb */
.sc-bxivhb {}

.ehsBOr{text-align:center;background-color:#464d5c;color:#fff;padding:40px 10px;font-size:40px;}
/* sc-component-id: sc-ifAKCX */
.sc-ifAKCX {}

.cKUUOL{color:#bee178;}
/* sc-component-id: sc-EHOje */
.sc-EHOje {}

.bUfeR{position:absolute;right:0px;padding:19px 19px;top:0px;border-radius:50%;background-color:transparent;border-color:transparent;-webkit-transition:0.5s background-color;transition:0.5s background-color;}
/* sc-component-id: sc-bZQynM */
.sc-bZQynM {}

.dQozFt{height:2px;width:18px;margin-bottom:3px;display:block;background-color:#bee178;}
/* sc-component-id: sc-gzVnrw */
.sc-gzVnrw {}

.bxrUCS{position:absolute;right:20px;top:42px;width:150px;height:125px;background-color:#fff;box-shadow:rgba(0,0,0,0.117647) 0 1px 6px, rgba(0,0,0,0.239216) 0 1px 4px;-webkit-transition:0.2s;transition:0.2s;overflow:hidden;padding:10px 0;}.bxrUCS > li{list-style:none;}.bxrUCS > li > a{-webkit-text-decoration:none;text-decoration:none;color:#777;display:block;padding:10px 20px;}
/* sc-component-id: sc-htoDjs */
.sc-htoDjs {}

.hBdBXi{position:absolute;bottom:20px;left:0;right:0;text-align:center;font-size:12px;}
/* sc-component-id: sc-dnqmqq */
.sc-dnqmqq {}

.gQextd{color:#999;}.gQextd > a{color:#bee178 !important;-webkit-text-decoration:none;text-decoration:none;}@media screen and (min-width:770px){.gQextd > a{color:#108ee9 !important;-webkit-text-decoration:underline;text-decoration:underline;}}
</style><style type="text/css" data-styled-components="" data-styled-components-is-local="false">/* sc-component-id: sc-global-1576189413 */
html{position:relative;background-color:#464d5c;font-family:'PingFang SC','Hiragino Sans GB','Microsoft Yahei','WenQuanYi Micro Hei',sans-serif;}@media screen and (min-width:770px){html{background-color:#ECF0F1;}}html,body{min-height:100vh;margin:0;padding:0;}#app{min-height:100vh;}
</style><style type="text/css" data-styled-components="gkwKrD gIWTme iLKjzi fCjyQ kqQANZ frgWBf OaFaI" data-styled-components-is-local="true">/* sc-component-id: sc-iwsKbI */
.sc-iwsKbI {}

.gkwKrD{position:relative;min-height:100vh;}
/* sc-component-id: sc-gZMcBi */
.sc-gZMcBi {}

.gIWTme{padding-bottom:60px;}@media screen and (min-width:770px){.gIWTme{padding:0px 0 100px;margin-left:calc(100vw - 100%);}}
/* sc-component-id: sc-gqjmRU */
.sc-gqjmRU {}

.iLKjzi{padding:20px 15px 25px;background-color:#fff;}@media screen and (min-width:770px){.iLKjzi{box-sizing:border-box;width:768px;margin:0 auto;padding-left:40px;padding-right:40px;box-shadow:0px 30px 60px 0px #d3dde2;}}
/* sc-component-id: sc-VigVT */
.sc-VigVT {}

.kqQANZ{margin-top:0;margin-bottom:30px;text-align:center;font-size:24px;}@media screen and (min-width:770px){.kqQANZ{font-size:30px;}}
/* sc-component-id: sc-jTzLTM */
.sc-jTzLTM {}

.frgWBf{text-align:center;color:#999;margin-top:50px;font-size:12px;-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: sc-fjdhpX */
.sc-fjdhpX {}

.OaFaI{background-color:#fff;padding-top:60px;}
/* sc-component-id: sc-jzJRlG */
.sc-jzJRlG {}

.fCjyQ{background-color:#fff;font-size:15px;color:#333;}@media screen and (min-width:770px){.fCjyQ{min-height:500px;}.fCjyQ a:hover{-webkit-text-decoration:underline;text-decoration:underline;cursor:pointer;}}.fCjyQ a{color:#3194d0;}.fCjyQ p,.fCjyQ li{line-height:1.8;}.fCjyQ img{display:block;max-width:100%;margin:0 auto 30px;}@media screen and (min-width:770px){.fCjyQ img{max-width:500px;}}.fCjyQ code{background:#f2f2f2;padding:2px 5px;}.fCjyQ pre{background:#f2f2f2;padding:20px;overflow-x:auto;line-height:1.8;}.fCjyQ pre > code{padding:0;}.fCjyQ blockquote{margin-left:0;padding:0 1em;color:#6a737d;border-left:0.25em solid #dfe2e5;}
</style>
</head>

<body>
    <div id="app"><div class="sc-iwsKbI gkwKrD" data-reactroot=""><div><ul class="sc-bdVaJa djiuUw"><li class="sc-bwzfXH ehFhRk"><a href="/">首页</a></li><li class="sc-bwzfXH ehFhRk"><a href="/archive.html">归档</a></li><li class="sc-bwzfXH ehFhRk"><a href="/about.html">关于</a></li></ul><div class="sc-htpNat bjznky"><div class="sc-bxivhb ehsBOr"><span class="sc-ifAKCX cKUUOL">&lt;Leodots /&gt;</span></div><button class="sc-EHOje bUfeR"><span class="sc-bZQynM dQozFt"></span><span class="sc-bZQynM dQozFt"></span><span class="sc-bZQynM dQozFt"></span></button><ul class="sc-gzVnrw bxrUCS" style="width:0;height:0"><li><a href="/">首页</a></li><li><a href="/archive.html">归档</a></li><li><a href="/about.html">关于</a></li></ul></div></div><div class="sc-gZMcBi gIWTme"><div class="sc-gqjmRU iLKjzi"><div class="sc-jzJRlG fCjyQ"><div class="sc-VigVT kqQANZ">ezpack dashboard</div><div class="sc-jzJRlG fCjyQ"><p>ezpack 是公司内部用的一个打包工具，基于 webpack。由 ezpack 构建的项目大部分都是多页面的，存在一种需求就是我想看下项目是跑在哪个端口，或者当前编译了哪些页面。一开始启动开发服务器的时候，还能显示这些信息，但是写着写着，信息就都会像下面这样被 webpack 的编译日志冲掉。</p>
<p><img src="http://ol07x5ssf.bkt.clouddn.com/build.png" alt="" /></p>
<p>针对这个问题，社区已经有了解决方案，就是 <a href="https://github.com/FormidableLabs/webpack-dashboard">webpack-dashboard</a>。不过 <code>webpack-dashboard</code> 没办法定制界面，所以不能直接嵌入到 ezpack 中。最后，我只能参考它的代码，自己从头写一个 dashboard。</p>
<p><code>webpack-dashboard</code> 底层是用 <a href="https://github.com/chjj/blessed">blessed</a> 去做界面显示。</p>
<pre><code class="js language-js">console.log('hello world');
</code></pre>
<p>默认情况下，上面打印的语句是会直接输出到终端的。而我们要做的是，不要输出到终端，而是输出到我们界面指定的地方。<code>console.xxx</code> 一系列的 API 最终都是调用 <code>process.stdout.write</code> 和 <code>process.stderr.write</code>。一个是标准输出，一个是标准错误。所以我们可以改写上面两个方法，不让它们直接输出到终端。</p>
<p><code>webpack-dashboard</code> 的做法是用两个进程，一个主进程用来做 UI 显示，另外再 fork 一个子进程来负责 webpack 编译。子进程的输出是不会直接打印到终端的，然后再监听子进程的标准输入和标准错误。</p>
<pre><code class="js language-js">child.stdout.on("data", data =&gt; {
    dashboard.setData([{
    type: "log",
    value: data.toString("utf8")
    }]);
});

child.stderr.on("data", data =&gt; {
    dashboard.setData([{
    type: "log",
    value: data.toString("utf8")
    }]);
});
</code></pre>
<p>这样子，输出既不会直接打印到屏幕，而我们又能拿到输出的内容，进行下一步的操作。后面自己在重写的时候，想着能不能在同一个进程里面做这个事情。上面也说了，输出会最终影响到 <code>process.stdout.write</code>，而 <code>blessed</code> 也是用这个方法来输出终端 UI 的。所以要做的是，在不影响 <code>blessed</code> 的情况下，改下 <code>process.stdout.write</code>。</p>
<p>还好的是，<code>blessed</code> 有个选项来指定标准输入输出。所以我们只要全局搜索一下 <code>blessed</code> 的源码，看下用了标准输出上面什么字段，就可以自己创建一个传进去。主要的代码逻辑大概像下面这样</p>
<pre><code class="js language-js">class Dashboard {
    constructor() {
        const stdout = process.stdout;

        this.screen = blessed.screen({
            output: {
                write: stdout.write.bind(stdout),
                isTTY: stdout.isTTY,
                on: stdout.on.bind(stdout),
                removeListener: stdout.removeListener.bind(stdout),
                writable: stdout.writable,
                bytesWritten: stdout.bytesWritten,
                columns: stdout.columns,
                rows: stdout.rows
            }
        });

        stdout.write = this.setLog.bind(this);
        process.stderr.write = stdout.write;
    }

    setLog(content) {
        // 输出到指定的地方
    }
}
</code></pre>
<p>为了不影响 <code>blessed</code> 的输出，<code>write</code> 方法还是指向原来的方法。stdout 的其它字段也都是 <code>blessed</code> 里面需要用到的。创建完之后，我们就可以把其它所有的输出都指向到 <code>setLog</code>。这样就可以拿到输出的内容，做下一步操作。</p>
<p>最后献上一张完整版的界面 ^_^</p>
<p><img src="http://ol07x5ssf.bkt.clouddn.com/WechatIMG548.jpeg" alt="" /></p></div><div class="sc-jTzLTM frgWBf">2018.05.02</div></div><div class="sc-fjdhpX OaFaI" id="disqus_thread"></div></div></div><div class="sc-htoDjs hBdBXi"><span class="sc-dnqmqq gQextd">Powered by <a href="https://github.com/clinyong/cubi">Cubi</a>,  </span><span class="sc-dnqmqq gQextd">Hosted by <a href="https://pages.coding.me">Coding Pages</a></span></div></div></div>
    
      <script>
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
              navigator.serviceWorker.register('/sw.js');
            });
          }
      </script>
      
    <script>
		
    </script>
    <script>
		var INIT_PROPS = {"content":{"meta":{"title":"ezpack dashboard","date":"2018.05.02"},"content":"\nezpack 是公司内部用的一个打包工具，基于 webpack。由 ezpack 构建的项目大部分都是多页面的，存在一种需求就是我想看下项目是跑在哪个端口，或者当前编译了哪些页面。一开始启动开发服务器的时候，还能显示这些信息，但是写着写着，信息就都会像下面这样被 webpack 的编译日志冲掉。\n\n![](http://ol07x5ssf.bkt.clouddn.com/build.png)\n\n针对这个问题，社区已经有了解决方案，就是 [webpack-dashboard](https://github.com/FormidableLabs/webpack-dashboard)。不过 `webpack-dashboard` 没办法定制界面，所以不能直接嵌入到 ezpack 中。最后，我只能参考它的代码，自己从头写一个 dashboard。\n\n`webpack-dashboard` 底层是用 [blessed](https://github.com/chjj/blessed) 去做界面显示。\n\n```js\nconsole.log('hello world');\n```\n\n默认情况下，上面打印的语句是会直接输出到终端的。而我们要做的是，不要输出到终端，而是输出到我们界面指定的地方。`console.xxx` 一系列的 API 最终都是调用 `process.stdout.write` 和 `process.stderr.write`。一个是标准输出，一个是标准错误。所以我们可以改写上面两个方法，不让它们直接输出到终端。\n\n`webpack-dashboard` 的做法是用两个进程，一个主进程用来做 UI 显示，另外再 fork 一个子进程来负责 webpack 编译。子进程的输出是不会直接打印到终端的，然后再监听子进程的标准输入和标准错误。\n\n```js\nchild.stdout.on(\"data\", data =&gt; {\n    dashboard.setData([{\n    type: \"log\",\n    value: data.toString(\"utf8\")\n    }]);\n});\n\nchild.stderr.on(\"data\", data => {\n    dashboard.setData([{\n    type: \"log\",\n    value: data.toString(\"utf8\")\n    }]);\n});\n```\n\n这样子，输出既不会直接打印到屏幕，而我们又能拿到输出的内容，进行下一步的操作。后面自己在重写的时候，想着能不能在同一个进程里面做这个事情。上面也说了，输出会最终影响到 `process.stdout.write`，而 `blessed` 也是用这个方法来输出终端 UI 的。所以要做的是，在不影响 `blessed` 的情况下，改下 `process.stdout.write`。\n\n还好的是，`blessed` 有个选项来指定标准输入输出。所以我们只要全局搜索一下 `blessed` 的源码，看下用了标准输出上面什么字段，就可以自己创建一个传进去。主要的代码逻辑大概像下面这样\n\n```js\nclass Dashboard {\n    constructor() {\n        const stdout = process.stdout;\n\n        this.screen = blessed.screen({\n\t\t\toutput: {\n\t\t\t\twrite: stdout.write.bind(stdout),\n\t\t\t\tisTTY: stdout.isTTY,\n\t\t\t\ton: stdout.on.bind(stdout),\n\t\t\t\tremoveListener: stdout.removeListener.bind(stdout),\n\t\t\t\twritable: stdout.writable,\n\t\t\t\tbytesWritten: stdout.bytesWritten,\n\t\t\t\tcolumns: stdout.columns,\n\t\t\t\trows: stdout.rows\n\t\t\t}\n\t\t});\n\n        stdout.write = this.setLog.bind(this);\n\t\tprocess.stderr.write = stdout.write;\n    }\n\n    setLog(content) {\n        // 输出到指定的地方\n    }\n}\n```\n\n为了不影响 `blessed` 的输出，`write` 方法还是指向原来的方法。stdout 的其它字段也都是 `blessed` 里面需要用到的。创建完之后，我们就可以把其它所有的输出都指向到 `setLog`。这样就可以拿到输出的内容，做下一步操作。\n\n最后献上一张完整版的界面 ^_^\n\n![](http://ol07x5ssf.bkt.clouddn.com/WechatIMG548.jpeg)\n"}};
    </script>
    
    <script src=/js/vendors.094c268b.dll.js></script>
    
    <script src=/js/__post.a85ba19a.dll.js></script>
    
    <script src=/js/post.cb81a6af.js></script>
    
</body>

</html>
