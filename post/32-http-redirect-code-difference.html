<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    
      <title>
        http 各种重定向状态码的区别 | Leodots
      </title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <style type="text/css" data-styled-components="djiuUw ehFhRk bjznky ehsBOr cKUUOL bUfeR dQozFt bxrUCS hBdBXi gQextd" data-styled-components-is-local="true">/* sc-component-id: sc-bdVaJa */
.sc-bdVaJa {}

.djiuUw{display:block;text-align:center;padding:0;margin:0;padding-top:30px;list-style:none;height:55px;margin-left:calc(100vw - 100%);}@media screen and (max-width:770px){.djiuUw{display:none;}}
/* sc-component-id: sc-bwzfXH */
.sc-bwzfXH {}

.ehFhRk{text-align:center;font-size:18px;margin:0 25px;display:inline-block;}.ehFhRk:hover{border-bottom:2px solid #222;}.ehFhRk > a{-webkit-text-decoration:none;text-decoration:none;color:#222;}
/* sc-component-id: sc-htpNat */
.sc-htpNat {}

.bjznky{position:relative;}@media screen and (min-width:770px){.bjznky{display:none;}}
/* sc-component-id: sc-bxivhb */
.sc-bxivhb {}

.ehsBOr{text-align:center;background-color:#464d5c;color:#fff;padding:40px 10px;font-size:40px;}
/* sc-component-id: sc-ifAKCX */
.sc-ifAKCX {}

.cKUUOL{color:#bee178;}
/* sc-component-id: sc-EHOje */
.sc-EHOje {}

.bUfeR{position:absolute;right:0px;padding:19px 19px;top:0px;border-radius:50%;background-color:transparent;border-color:transparent;-webkit-transition:0.5s background-color;transition:0.5s background-color;}
/* sc-component-id: sc-bZQynM */
.sc-bZQynM {}

.dQozFt{height:2px;width:18px;margin-bottom:3px;display:block;background-color:#bee178;}
/* sc-component-id: sc-gzVnrw */
.sc-gzVnrw {}

.bxrUCS{position:absolute;right:20px;top:42px;width:150px;height:125px;background-color:#fff;box-shadow:rgba(0,0,0,0.117647) 0 1px 6px, rgba(0,0,0,0.239216) 0 1px 4px;-webkit-transition:0.2s;transition:0.2s;overflow:hidden;padding:10px 0;}.bxrUCS > li{list-style:none;}.bxrUCS > li > a{-webkit-text-decoration:none;text-decoration:none;color:#777;display:block;padding:10px 20px;}
/* sc-component-id: sc-htoDjs */
.sc-htoDjs {}

.hBdBXi{position:absolute;bottom:20px;left:0;right:0;text-align:center;font-size:12px;}
/* sc-component-id: sc-dnqmqq */
.sc-dnqmqq {}

.gQextd{color:#999;}.gQextd > a{color:#bee178 !important;-webkit-text-decoration:none;text-decoration:none;}@media screen and (min-width:770px){.gQextd > a{color:#108ee9 !important;-webkit-text-decoration:underline;text-decoration:underline;}}
</style><style type="text/css" data-styled-components="" data-styled-components-is-local="false">/* sc-component-id: sc-global-1576189413 */
html{position:relative;background-color:#464d5c;font-family:'PingFang SC','Hiragino Sans GB','Microsoft Yahei','WenQuanYi Micro Hei',sans-serif;}@media screen and (min-width:770px){html{background-color:#ECF0F1;}}html,body{min-height:100vh;margin:0;padding:0;}#app{min-height:100vh;}
</style><style type="text/css" data-styled-components="gkwKrD gIWTme iLKjzi fCjyQ kqQANZ frgWBf OaFaI" data-styled-components-is-local="true">/* sc-component-id: sc-iwsKbI */
.sc-iwsKbI {}

.gkwKrD{position:relative;min-height:100vh;}
/* sc-component-id: sc-gZMcBi */
.sc-gZMcBi {}

.gIWTme{padding-bottom:60px;}@media screen and (min-width:770px){.gIWTme{padding:0px 0 100px;margin-left:calc(100vw - 100%);}}
/* sc-component-id: sc-gqjmRU */
.sc-gqjmRU {}

.iLKjzi{padding:20px 15px 25px;background-color:#fff;}@media screen and (min-width:770px){.iLKjzi{box-sizing:border-box;width:768px;margin:0 auto;padding-left:40px;padding-right:40px;box-shadow:0px 30px 60px 0px #d3dde2;}}
/* sc-component-id: sc-VigVT */
.sc-VigVT {}

.kqQANZ{margin-top:0;margin-bottom:30px;text-align:center;font-size:24px;}@media screen and (min-width:770px){.kqQANZ{font-size:30px;}}
/* sc-component-id: sc-jTzLTM */
.sc-jTzLTM {}

.frgWBf{text-align:center;color:#999;margin-top:50px;font-size:12px;-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: sc-fjdhpX */
.sc-fjdhpX {}

.OaFaI{background-color:#fff;padding-top:60px;}
/* sc-component-id: sc-jzJRlG */
.sc-jzJRlG {}

.fCjyQ{background-color:#fff;font-size:15px;color:#333;}@media screen and (min-width:770px){.fCjyQ{min-height:500px;}.fCjyQ a:hover{-webkit-text-decoration:underline;text-decoration:underline;cursor:pointer;}}.fCjyQ a{color:#3194d0;}.fCjyQ p,.fCjyQ li{line-height:1.8;}.fCjyQ img{display:block;max-width:100%;margin:0 auto 30px;}@media screen and (min-width:770px){.fCjyQ img{max-width:500px;}}.fCjyQ code{background:#f2f2f2;padding:2px 5px;}.fCjyQ pre{background:#f2f2f2;padding:20px;overflow-x:auto;line-height:1.8;}.fCjyQ pre > code{padding:0;}.fCjyQ blockquote{margin-left:0;padding:0 1em;color:#6a737d;border-left:0.25em solid #dfe2e5;}
</style>
</head>

<body>
    <div id="app"><div class="sc-iwsKbI gkwKrD" data-reactroot=""><div><ul class="sc-bdVaJa djiuUw"><li class="sc-bwzfXH ehFhRk"><a href="/">首页</a></li><li class="sc-bwzfXH ehFhRk"><a href="/archive.html">归档</a></li><li class="sc-bwzfXH ehFhRk"><a href="/about.html">关于</a></li></ul><div class="sc-htpNat bjznky"><div class="sc-bxivhb ehsBOr"><span class="sc-ifAKCX cKUUOL">&lt;Leodots /&gt;</span></div><button class="sc-EHOje bUfeR"><span class="sc-bZQynM dQozFt"></span><span class="sc-bZQynM dQozFt"></span><span class="sc-bZQynM dQozFt"></span></button><ul class="sc-gzVnrw bxrUCS" style="width:0;height:0"><li><a href="/">首页</a></li><li><a href="/archive.html">归档</a></li><li><a href="/about.html">关于</a></li></ul></div></div><div class="sc-gZMcBi gIWTme"><div class="sc-gqjmRU iLKjzi"><div class="sc-jzJRlG fCjyQ"><div class="sc-VigVT kqQANZ">http 各种重定向状态码的区别</div><div class="sc-jzJRlG fCjyQ"><p>常用的重定向状态码有哪些呢？</p>
<ul>
<li>301</li>
<li>302</li>
<li>303</li>
<li>307</li>
</ul>
<p>网上解释的文章很多，看下来还是没理解明白。《HTTP权威指南》这块也没讲清楚，还是老老实实看下<a href="https://tools.ietf.org/html/rfc7231">规范</a>吧。</p>
<h3 id="301">301</h3>
<blockquote>
  <p>The 301 (Moved Permanently) status code indicates that the target resource has been assigned a new permanent URI and any future references to this resource ought to use one of the enclosed URIs.</p>
</blockquote>
<p>301 表示请求的资源已经永久换了地址，下次就不要再用这个地址了，而用返回头部的新地址。</p>
<p>对于普通用户来说，并不会去关心这些状态码，比如当我们在用浏览器访问一个页面的时候，也不会因为是返回 301，就在下次访问的时候用新的地址。实际上，浏览器已经帮我们做了这个事情。写个简单的例子测试一下。</p>
<pre><code class="js language-js">const express = require("express");
const morgan = require("morgan");
const app = express();

app.set("etag", false);

const port = "1234";
const url = `http://localhost:${port}`;

app.use(morgan(":method :url :status"));
app.get("/301", function(req, res) {
  res.redirect(301, url + "/200");
});
app.get("/200", function(req, res) {
  res.send("hello world");
});

console.log(`Listening on ${url}`);

app.listen(port);
</code></pre>
<p><code>morgan</code> 是一个 express 打印路由日志的中间件，这里我们也把 <code>etag</code> 去掉，避免缓存的影响。</p>
<p>接着先用 Chrome 访问 <code>http://localhost:1234/301</code>，然后再新开一个 tab，再次访问 <code>/301</code> 路径。下面是终端打印出来的路由。</p>
<pre><code>GET /301 301
GET /200 200
GET /200 200
</code></pre>
<p>可以看到，第二次请求的时候，浏览器直接访问了 <code>/200</code> 这个路径。</p>
<h3 id="302">302</h3>
<blockquote>
  <p>The 302 (Found) status code indicates that the target resource resides temporarily under a different URI. The client ought to continue to use the effective request URI for future requests.</p>
</blockquote>
<p>302 表示这个资源只是暂时换了地址，下次访问的时候还是继续用原来的地址。在上面的 <code>express</code> 例子增加一条路由测试 302。</p>
<pre><code class="js language-js">app.get("/302", function(req, res) {
  res.redirect(302, url + "/200");
});
</code></pre>
<p>然后按同样的方法，两次访问这个地址，看下终端的输出。</p>
<pre><code>GET /302 302
GET /200 200
GET /302 302
GET /200 200
</code></pre>
<p>嗯，和规范说的一样，第二次还是访问原先的地址。</p>
<h3 id="303">303</h3>
<blockquote>
  <p>The 303 (See Other) status code indicates that the server is redirecting the user agent to a different resource</p>
  <p>A user agent can perform a retrieval request targeting that URI (a GET or HEAD request if using HTTP)</p>
  <p>This status code is applicable to any HTTP method. It is primarily used to allow the output of a POST action to redirect the user agent to a selected resource.</p>
</blockquote>
<p>首先，303 返回的是另外一个资源。不像上面两个，都是指向同个资源，只是地址发生改变。客户端，也就是 user agent 在做重定向的时候，需要用 GET 和 HEAD 方法。最后是 303 主要是用来处理 POST 请求。</p>
<p>规范对于 303 的描述有点难理解，于是乎再查了下<a href="https://www.wikiwand.com/zh-hans/HTTP_303">维基百科</a>和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/303">MDN</a>。如果对于一个 POST 请求，要返回一个新的页面，比如消息确认页面或上传进度页，这时候就应该用 303。</p>
<p>用 <code>express</code> 试了一下，对于重定向 POST 请求，用 301/302/303 返回，浏览器的行为都是一样的。但是在实际的开发当中，应该还是照着规范来比较好。</p>
<h3 id="307">307</h3>
<blockquote>
  <p>The user agent MUST NOT change the request method if it performs an automatic redirection to that URI.</p>
  <p>This status code is similar to 302 (Found), except that it does not allow changing the request method from POST to GET.</p>
</blockquote>
<p>307 和 302 基本一样，唯一的区别在于重定向的时候不能改变请求方法。我们在上面的 <code>express</code> 例子加多一个 POST 的路由</p>
<pre><code class="js language-js">app.post("/307", function(req, res) {
  res.redirect(307, url + "/200");
});
</code></pre>
<p>然后写一个简单的表单</p>
<pre><code class="html language-html">&lt;form action="/307" method="POST"&gt;
    &lt;button&gt;submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<p>当我们访问这个页面，点击 submit 的时候，终端的路由输出如下</p>
<pre><code>POST /307 307
POST /200 404
</code></pre>
<p>因为我们并没有注册一个 POST 方法到 <code>/200</code> 的路径，所以返回 404。可以看到，第二次的重定向请求，浏览器是用 POST 方法。</p>
<p>写完这篇文章的感受，做了这么多年 web 开发，终于理解了各个重定向状态码的区别。:-(</p>
<p>（完）</p></div><div class="sc-jTzLTM frgWBf">2018.08.01</div></div><div class="sc-fjdhpX OaFaI" id="disqus_thread"></div></div></div><div class="sc-htoDjs hBdBXi"><span class="sc-dnqmqq gQextd">Powered by <a href="https://github.com/clinyong/cubi">Cubi</a>,  </span><span class="sc-dnqmqq gQextd">Hosted by <a href="https://pages.coding.me">Coding Pages</a></span></div></div></div>
    
      <script>
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
              navigator.serviceWorker.register('/sw.js');
            });
          }
      </script>
      
    <script>
		
    </script>
    <script>
		var INIT_PROPS = {"content":{"meta":{"title":"http 各种重定向状态码的区别","date":"2018.08.01"},"content":"\n常用的重定向状态码有哪些呢？\n\n- 301\n- 302\n- 303\n- 307\n\n网上解释的文章很多，看下来还是没理解明白。《HTTP权威指南》这块也没讲清楚，还是老老实实看下[规范](https://tools.ietf.org/html/rfc7231)吧。\n\n### 301\n\n&gt; The 301 (Moved Permanently) status code indicates that the target resource has been assigned a new permanent URI and any future references to this resource ought to use one of the enclosed URIs.\n\n301 表示请求的资源已经永久换了地址，下次就不要再用这个地址了，而用返回头部的新地址。\n\n对于普通用户来说，并不会去关心这些状态码，比如当我们在用浏览器访问一个页面的时候，也不会因为是返回 301，就在下次访问的时候用新的地址。实际上，浏览器已经帮我们做了这个事情。写个简单的例子测试一下。\n\n```js\nconst express = require(\"express\");\nconst morgan = require(\"morgan\");\nconst app = express();\n\napp.set(\"etag\", false);\n\nconst port = \"1234\";\nconst url = `http://localhost:${port}`;\n\napp.use(morgan(\":method :url :status\"));\napp.get(\"/301\", function(req, res) {\n  res.redirect(301, url + \"/200\");\n});\napp.get(\"/200\", function(req, res) {\n  res.send(\"hello world\");\n});\n\nconsole.log(`Listening on ${url}`);\n\napp.listen(port);\n```\n\n`morgan` 是一个 express 打印路由日志的中间件，这里我们也把 `etag` 去掉，避免缓存的影响。\n\n接着先用 Chrome 访问 `http://localhost:1234/301`，然后再新开一个 tab，再次访问 `/301` 路径。下面是终端打印出来的路由。\n\n```\nGET /301 301\nGET /200 200\nGET /200 200\n```\n\n可以看到，第二次请求的时候，浏览器直接访问了 `/200` 这个路径。\n\n### 302\n\n> The 302 (Found) status code indicates that the target resource resides temporarily under a different URI. The client ought to continue to use the effective request URI for future requests.\n\n302 表示这个资源只是暂时换了地址，下次访问的时候还是继续用原来的地址。在上面的 `express` 例子增加一条路由测试 302。\n\n```js\napp.get(\"/302\", function(req, res) {\n  res.redirect(302, url + \"/200\");\n});\n```\n\n然后按同样的方法，两次访问这个地址，看下终端的输出。\n\n```\nGET /302 302\nGET /200 200\nGET /302 302\nGET /200 200\n```\n\n嗯，和规范说的一样，第二次还是访问原先的地址。\n\n### 303\n\n> The 303 (See Other) status code indicates that the server is redirecting the user agent to a different resource\n>\n> A user agent can perform a retrieval request targeting that URI (a GET or HEAD request if using HTTP)\n>\n> This status code is applicable to any HTTP method. It is primarily used to allow the output of a POST action to redirect the user agent to a selected resource.\n\n首先，303 返回的是另外一个资源。不像上面两个，都是指向同个资源，只是地址发生改变。客户端，也就是 user agent 在做重定向的时候，需要用 GET 和 HEAD 方法。最后是 303 主要是用来处理 POST 请求。\n\n规范对于 303 的描述有点难理解，于是乎再查了下[维基百科](https://www.wikiwand.com/zh-hans/HTTP_303)和 [MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/303)。如果对于一个 POST 请求，要返回一个新的页面，比如消息确认页面或上传进度页，这时候就应该用 303。\n\n用 `express` 试了一下，对于重定向 POST 请求，用 301/302/303 返回，浏览器的行为都是一样的。但是在实际的开发当中，应该还是照着规范来比较好。\n\n### 307\n\n> The user agent MUST NOT change the request method if it performs an automatic redirection to that URI.\n>\n> This status code is similar to 302 (Found), except that it does not allow changing the request method from POST to GET.\n\n307 和 302 基本一样，唯一的区别在于重定向的时候不能改变请求方法。我们在上面的 `express` 例子加多一个 POST 的路由\n\n```js\napp.post(\"/307\", function(req, res) {\n  res.redirect(307, url + \"/200\");\n});\n```\n\n然后写一个简单的表单\n\n```html\n&lt;form action=\"/307\" method=\"POST\">\n    &lt;button>submit&lt;/button>\n&lt;/form>\n```\n\n当我们访问这个页面，点击 submit 的时候，终端的路由输出如下\n\n```\nPOST /307 307\nPOST /200 404\n```\n\n因为我们并没有注册一个 POST 方法到 `/200` 的路径，所以返回 404。可以看到，第二次的重定向请求，浏览器是用 POST 方法。\n\n写完这篇文章的感受，做了这么多年 web 开发，终于理解了各个重定向状态码的区别。:-(\n\n（完）\n"}};
    </script>
    
    <script src=/js/vendors.f58cabc9.dll.js></script>
    
    <script src=/js/__post.6c7dc1cb.dll.js></script>
    
    <script src=/js/post.9e5c2604.js></script>
    
</body>

</html>
